drop table account;
drop table audit_log;
drop table int_rate;
drop table documents;
drop table approved_loan;
drop table loan_application;
drop table transaction;
drop table customers;
drop table employee;
drop table users;
drop table city;



create table city(
code number primary key,
name varchar2(20),
state varchar2(20));


create table users(
id number generated by default on null as identity,
gender varchar2(6),
phone char(10),
email varchar2(30) unique not null,
pwd varchar2(20) not null,
fname varchar2(20),
sname varchar2(20),
dob date,
city_code number,
role varchar2(10),
constraint chk_contact_phone check(regexp_like(phone,'^[0-9]{10}$')),
constraint id_pk Primary key (id));


create table employee(
user_id number,
working_hr number,
constraint fk_user_id_emp foreign key (user_id) references users(id)
);

create table customers(
user_id number,
acc_no number not null,
constraint fk_user_id_cust foreign key (user_id) references users(id)
);

create table transaction(
id number generated by default on null as identity,
type varchar(7) not null,
logged_at timestamp (2) not null,
user_id not null,
amount number(20,2),
constraint id_pk_trans Primary key (id),
constraint fk_user_id_trans foreign key (user_id) references users(id));

create table loan_application(
app_id number generated by default on null as identity,
cust_id number,
loan_type varchar2(20) not null,
loan_amt number(20,2) not null,
mode_pymnt varchar2(15),
int_rate number(4,2) not null,
emi_val number(20,2) not null,
tenure number not null,
constraint id_pk_app primary key (app_id),
constraint fk_cust_id foreign key (cust_id) references users(id),
constraint unique_c unique(cust_id,loan_type)
);

create table approved_loan(
app_id number,
cust_id number,
loan_type varchar2(20) not null,
loan_amt number(20,2) not null,
mode_pymnt varchar2(15),
int_rate number(4,2) not null,
emi_val number(20,2) not null,
tenure number not null,
loan_bal number(20,2),
mgr_id number,
constraint id_pk_app_appr primary key (app_id),
constraint fk_cust_id_appr foreign key (cust_id) references users(id),
constraint fk_mgr_id foreign key (mgr_id) references users(id)
);

create table documents(
doc_id number generated by default on null as identity,
cust_id number not null,
doc_link blob not null,
app_id number not null,
type varchar2(20),
constraint pk_doc_id primary key (doc_id)
);

create table int_rate(
id number generated by default on null as identity,
age_grp number,
city_code number,
int_rate number(4,2),
loan_type varchar2(20),
tenure number,
constraint pk_id_rate primary key (id),
constraint fk_city_code foreign key (city_code) references city(code)
);  

create table audit_log(
audit_id number generated by default on null as identity,
app_id number not null,
cust_id number,
loan_type varchar2(20) not null,
loan_amt number not null,
mode_pymnt varchar2(15),
int_rate number(4,2) not null,
emi_val number not null,
tenure number not null,
loan_bal number,
mgr_id number,
status varchar2(15) not null,
loagged_at timestamp (2) not null,
constraint id_pk_log primary key (audit_id),
constraint fk_cust_id_log foreign key (cust_id) references users(id),
constraint fk_mgr_id_log foreign key (mgr_id) references users(id)
);

create table account(
acc_no number Primary key,
balance number,
type varchar2(20));